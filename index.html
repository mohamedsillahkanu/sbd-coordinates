<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNT Code Library - Theme Injector</title>
    <style>
        /* Container styling for the iframe wrapper */
        .snt-iframe-container {
            width: 100%;
            height: 100vh;
            position: relative;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            padding: 0;
            margin: 0;
            overflow: hidden;
        }

        .snt-iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        /* Loading overlay */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }

        .loading-text {
            color: #60a5fa;
            font-size: 1.5rem;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* Theme toggle button */
        .theme-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1001;
            background: rgba(30, 41, 59, 0.9);
            padding: 10px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .theme-btn {
            background: #475569;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            margin: 0 5px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .theme-btn:hover {
            background: #1e293b;
            transform: translateY(-2px);
        }

        .theme-btn.active {
            background: #3b82f6;
        }
    </style>
</head>
<body>
    <div class="snt-iframe-container">
        <!-- Loading overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-text">Loading SNT Code Library...</div>
        </div>

        <!-- Theme controls -->
        <div class="theme-controls">
            <button class="theme-btn active" onclick="applyMalariaTheme()" id="darkThemeBtn">Dark Theme</button>
            <button class="theme-btn" onclick="removeTheme()" id="originalThemeBtn">Original</button>
            <button class="theme-btn" onclick="forceReapplyTheme()" id="forceBtn">Force Apply</button>
        </div>

        <!-- SNT Code Library iframe -->
        <iframe 
            id="sntLibraryFrame"
            src="https://ahadi-analytics.github.io/snt-code-library/?embed=true"
            class="snt-iframe"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-presentation">
        </iframe>
    </div>

    <script>
        // Malaria theme CSS to inject
        const malariaThemeCSS = `
            /* COMPLETE MALARIA THEME OVERRIDE */
            *, *::before, *::after {
                transition: background-color 0.3s ease, color 0.3s ease !important;
            }

            /* Force dark background */
            html, body, div, main, section, article, header, footer,
            .container, .content, .wrapper, .page, .site,
            .markdown-body, .highlight, .gist {
                background-color: #1e293b !important;
                background: #1e293b !important;
                color: #e2e8f0 !important;
            }

            /* Root background gradient */
            body {
                background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%) !important;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
                line-height: 1.6 !important;
                color: #e2e8f0 !important;
            }

            /* Headers - malaria style */
            h1, h2, h3, h4, h5, h6,
            .header, .title, .heading {
                background: linear-gradient(135deg, #1e40af, #1d4ed8) !important;
                color: white !important;
                padding: 20px !important;
                border-radius: 12px !important;
                margin: 20px 0 !important;
                text-align: center !important;
                box-shadow: 0 10px 30px rgba(30,64,175,0.3) !important;
                text-shadow: 2px 2px 4px rgba(0,0,0,0.3) !important;
            }

            /* Sub-headers */
            h2, h3 {
                background: #334155 !important;
                color: #60a5fa !important;
                padding: 15px 20px !important;
                border-left: 5px solid #3b82f6 !important;
                font-size: 1.5em !important;
            }

            /* Content sections */
            .section, .content-section, .post, .article,
            .entry, .item, .card, .panel {
                background: #334155 !important;
                padding: 25px !important;
                border-radius: 12px !important;
                margin: 20px 0 !important;
                border-left: 5px solid #3b82f6 !important;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2) !important;
                color: #e2e8f0 !important;
            }

            /* Text elements */
            p, span, div, li, td, th, label,
            .text, .content, .description {
                color: #cbd5e1 !important;
                background: transparent !important;
            }

            /* Links */
            a, a:visited {
                color: #60a5fa !important;
                text-decoration: none !important;
            }

            a:hover {
                color: #3b82f6 !important;
                text-decoration: underline !important;
            }

            /* Code blocks - malaria style */
            code, pre, .code, .highlight, .highlighter-rouge,
            .language-r, .language-python, .language-javascript {
                background: #0f172a !important;
                color: #e2e8f0 !important;
                padding: 20px !important;
                border-radius: 8px !important;
                font-family: 'Consolas', 'Monaco', 'Courier New', monospace !important;
                border: 1px solid #334155 !important;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3) !important;
            }

            /* Inline code */
            code:not(pre code) {
                background: #334155 !important;
                color: #60a5fa !important;
                padding: 2px 6px !important;
                border-radius: 4px !important;
                font-size: 0.9em !important;
            }

            /* Syntax highlighting */
            .token.comment { color: #34d399 !important; }
            .token.function { color: #fbbf24 !important; }
            .token.string { color: #a78bfa !important; }
            .token.number { color: #fbbf24 !important; }
            .token.operator { color: #f87171 !important; }
            .token.keyword { color: #60a5fa !important; }

            /* Tables */
            table, th, td {
                background: #334155 !important;
                border: 1px solid #475569 !important;
                color: #e2e8f0 !important;
                padding: 12px !important;
            }

            th {
                background: #1e293b !important;
                color: #60a5fa !important;
                font-weight: bold !important;
            }

            /* Buttons */
            button, .btn, .button, input[type="button"] {
                background: #475569 !important;
                color: white !important;
                border: none !important;
                padding: 10px 20px !important;
                border-radius: 8px !important;
                cursor: pointer !important;
                transition: all 0.3s ease !important;
            }

            button:hover, .btn:hover, .button:hover {
                background: #1e293b !important;
                transform: translateY(-2px) !important;
            }

            /* Navigation */
            nav, .nav, .navbar, .navigation {
                background: #334155 !important;
                padding: 15px !important;
                border-radius: 8px !important;
                border-bottom: 2px solid #3b82f6 !important;
            }

            nav a, .nav a, .navbar a {
                color: #60a5fa !important;
                padding: 8px 15px !important;
                border-radius: 6px !important;
            }

            nav a:hover, .nav a:hover, .navbar a:hover {
                background: #1e293b !important;
                color: #3b82f6 !important;
            }

            /* Form elements */
            input, textarea, select {
                background: #334155 !important;
                color: #e2e8f0 !important;
                border: 1px solid #475569 !important;
                padding: 10px !important;
                border-radius: 6px !important;
            }

            input:focus, textarea:focus, select:focus {
                border-color: #3b82f6 !important;
                box-shadow: 0 0 10px rgba(59, 130, 246, 0.3) !important;
            }

            /* Lists */
            ul, ol {
                color: #cbd5e1 !important;
            }

            li {
                color: #cbd5e1 !important;
                margin: 8px 0 !important;
            }

            /* Blockquotes */
            blockquote {
                background: #334155 !important;
                border-left: 4px solid #3b82f6 !important;
                color: #cbd5e1 !important;
                padding: 15px 20px !important;
                margin: 20px 0 !important;
                border-radius: 0 8px 8px 0 !important;
            }

            /* Remove any white backgrounds */
            * {
                background-color: transparent !important;
            }

            /* Specific overrides for common classes */
            .bg-white, .background-white, .white-bg {
                background: #1e293b !important;
            }

            .text-black, .black-text {
                color: #e2e8f0 !important;
            }

            /* Progress bars */
            .progress {
                background: #374151 !important;
            }

            .progress-bar {
                background: linear-gradient(90deg, #3b82f6, #60a5fa) !important;
            }

            /* Cards and panels */
            .card, .panel, .widget {
                background: #334155 !important;
                border: 1px solid #475569 !important;
                border-radius: 12px !important;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2) !important;
            }

            /* Scrollbars */
            ::-webkit-scrollbar {
                width: 12px;
                background: #1e293b;
            }

            ::-webkit-scrollbar-thumb {
                background: #475569;
                border-radius: 6px;
            }

            ::-webkit-scrollbar-thumb:hover {
                background: #60a5fa;
            }
        `;

        let themeApplied = false;
        let styleElement = null;

        function applyMalariaTheme() {
            const iframe = document.getElementById('sntLibraryFrame');
            
            try {
                // Wait for iframe to load
                iframe.onload = function() {
                    try {
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        
                        // Remove existing theme if present
                        const existingStyle = iframeDoc.getElementById('malaria-theme');
                        if (existingStyle) {
                            existingStyle.remove();
                        }

                        // Create and inject new style
                        styleElement = iframeDoc.createElement('style');
                        styleElement.id = 'malaria-theme';
                        styleElement.textContent = malariaThemeCSS;
                        iframeDoc.head.appendChild(styleElement);

                        // Also try to append to body if head injection fails
                        if (!iframeDoc.getElementById('malaria-theme')) {
                            iframeDoc.body.appendChild(styleElement);
                        }

                        themeApplied = true;
                        updateButtonStates(true);
                        console.log('Malaria theme applied successfully!');
                        
                        // Hide loading overlay
                        setTimeout(() => {
                            document.getElementById('loadingOverlay').classList.add('hidden');
                        }, 1000);

                    } catch (e) {
                        console.log('Direct iframe access blocked by CORS. Trying alternative methods...');
                        tryAlternativeMethods();
                    }
                };

                // If iframe is already loaded, apply immediately
                if (iframe.contentDocument) {
                    iframe.onload();
                }

            } catch (e) {
                console.log('Error applying theme:', e);
                tryAlternativeMethods();
            }
        }

        function tryAlternativeMethods() {
            // Method 1: Try postMessage communication
            const iframe = document.getElementById('sntLibraryFrame');
            
            // Send theme CSS via postMessage
            iframe.contentWindow.postMessage({
                type: 'APPLY_THEME',
                css: malariaThemeCSS
            }, '*');

            // Method 2: Create a proxy approach
            console.log('Attempting alternative theme application methods...');
            
            // Hide loading overlay anyway
            setTimeout(() => {
                document.getElementById('loadingOverlay').classList.add('hidden');
            }, 2000);

            // Method 3: URL parameter approach
            const currentSrc = iframe.src;
            if (!currentSrc.includes('theme=dark')) {
                iframe.src = currentSrc + (currentSrc.includes('?') ? '&' : '?') + 'theme=dark';
            }
        }

        function removeTheme() {
            const iframe = document.getElementById('sntLibraryFrame');
            
            try {
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                const themeStyle = iframeDoc.getElementById('malaria-theme');
                
                if (themeStyle) {
                    themeStyle.remove();
                    themeApplied = false;
                    updateButtonStates(false);
                    console.log('Theme removed successfully!');
                }
            } catch (e) {
                // Send remove theme message
                iframe.contentWindow.postMessage({
                    type: 'REMOVE_THEME'
                }, '*');
                
                updateButtonStates(false);
                console.log('Theme removal attempted via postMessage');
            }
        }

        function forceReapplyTheme() {
            // Force reload and reapply
            const iframe = document.getElementById('sntLibraryFrame');
            const currentSrc = iframe.src;
            
            document.getElementById('loadingOverlay').classList.remove('hidden');
            
            iframe.src = '';
            setTimeout(() => {
                iframe.src = currentSrc;
                setTimeout(applyMalariaTheme, 1000);
            }, 500);
        }

        function updateButtonStates(themeActive) {
            const darkBtn = document.getElementById('darkThemeBtn');
            const originalBtn = document.getElementById('originalThemeBtn');
            
            if (themeActive) {
                darkBtn.classList.add('active');
                originalBtn.classList.remove('active');
            } else {
                darkBtn.classList.remove('active');
                originalBtn.classList.add('active');
            }
        }

        // Listen for messages from iframe
        window.addEventListener('message', function(event) {
            if (event.data.type === 'THEME_APPLIED') {
                themeApplied = true;
                updateButtonStates(true);
                document.getElementById('loadingOverlay').classList.add('hidden');
            } else if (event.data.type === 'THEME_REMOVED') {
                themeApplied = false;
                updateButtonStates(false);
            }
        });

        // Auto-apply theme on load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(applyMalariaTheme, 1000);
            
            // Periodic re-application for dynamic content
            setInterval(() => {
                if (themeApplied) {
                    applyMalariaTheme();
                }
            }, 5000);
        });

        // Handle iframe load events
        document.getElementById('sntLibraryFrame').addEventListener('load', function() {
            if (themeApplied) {
                setTimeout(applyMalariaTheme, 500);
            }
        });
    </script>
</body>
</html>
